
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://klust.github.io/LUMI-BE-training-materials/intro-evolving/E07_Exercises_4/">
      
      
        <link rel="prev" href="../07_Binding/">
      
      
        <link rel="next" href="../08_Lustre/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.10">
    
    
      
        <title>Exercises 4 - LUMI-BE training materials</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e359304.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--demo:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M0 192h176V0h-16C71.6 0 0 71.6 0 160v32zm0 32v128c0 88.4 71.6 160 160 160h64c88.4 0 160-71.6 160-160V224H0zm384-32v-32C384 71.6 312.4 0 224 0h-16v192h176z"/></svg>');--md-admonition-icon--exercise:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M78.6 5c-9.5-7.4-23-6.5-31.6 2L7 47c-8.5 8.5-9.4 22-2.1 31.6l80 104c4.5 5.9 11.6 9.4 19 9.4H158l109 109c-14.7 29-10 65.4 14.3 89.6l112 112c12.5 12.5 32.8 12.5 45.3 0l64-64c12.5-12.5 12.5-32.8 0-45.3l-112-112c-24.2-24.2-60.6-29-89.6-14.3L192 158v-54c0-7.5-3.5-14.5-9.4-19L78.6 5zM19.9 396.1C7.2 408.8 0 426.1 0 444.1 0 481.6 30.4 512 67.9 512c18 0 35.3-7.2 48-19.9l117.8-117.8c-7.8-20.9-9-43.6-3.6-65.1l-61.7-61.7L19.9 396.1zM512 144c0-10.5-1.1-20.7-3.2-30.5-2.4-11.2-16.1-14.1-24.2-6l-63.9 63.9c-3 3-7.1 4.7-11.3 4.7H352c-8.8 0-16-7.2-16-16v-57.5c0-4.2 1.7-8.3 4.7-11.3l63.9-63.9c8.1-8.1 5.2-21.8-6-24.2C388.7 1.1 378.5 0 368 0c-79.5 0-144 64.5-144 144v.8l85.3 85.3c36-9.1 75.8.5 104 28.7l15.7 15.7c49-23 83-72.8 83-130.5zM56 432a24 24 0 1 1 48 0 24 24 0 1 1-48 0z"/></svg>');--md-admonition-icon--remark:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M256 448c141.4 0 256-93.1 256-208S397.4 32 256 32 0 125.1 0 240c0 45.1 17.7 86.8 47.7 120.9-1.9 24.5-11.4 46.3-21.4 62.9-5.5 9.2-11.1 16.6-15.2 21.6-2.1 2.5-3.7 4.4-4.9 5.7-.6.6-1 1.1-1.3 1.4l-.3.3c-4.6 4.6-5.9 11.4-3.4 17.4 2.5 6 8.3 9.9 14.8 9.9 28.7 0 57.6-8.9 81.6-19.3 22.9-10 42.4-21.9 54.3-30.6 31.8 11.5 67 17.9 104.1 17.9zM128 208a32 32 0 1 1 0 64 32 32 0 1 1 0-64zm128 0a32 32 0 1 1 0 64 32 32 0 1 1 0-64zm96 32a32 32 0 1 1 64 0 32 32 0 1 1-64 0z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M320 0c17.7 0 32 14.3 32 32v64h120c39.8 0 72 32.2 72 72v272c0 39.8-32.2 72-72 72H168c-39.8 0-72-32.2-72-72V168c0-39.8 32.2-72 72-72h120V32c0-17.7 14.3-32 32-32zM208 384c-8.8 0-16 7.2-16 16s7.2 16 16 16h32c8.8 0 16-7.2 16-16s-7.2-16-16-16h-32zm96 0c-8.8 0-16 7.2-16 16s7.2 16 16 16h32c8.8 0 16-7.2 16-16s-7.2-16-16-16h-32zm96 0c-8.8 0-16 7.2-16 16s7.2 16 16 16h32c8.8 0 16-7.2 16-16s-7.2-16-16-16h-32zM264 256a40 40 0 1 0-80 0 40 40 0 1 0 80 0zm152 40a40 40 0 1 0 0-80 40 40 0 1 0 0 80zM48 224h16v192H48c-26.5 0-48-21.5-48-48v-96c0-26.5 21.5-48 48-48zm544 0c26.5 0 48 21.5 48 48v96c0 26.5-21.5 48-48 48h-16V224h16z"/></svg>');--md-admonition-icon--audience:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M72 88a56 56 0 1 1 112 0 56 56 0 1 1-112 0zm-8 157.7c-10 11.2-16 26.1-16 42.3s6 31.1 16 42.3v-84.6zm144.4-49.3C178.7 222.7 160 261.2 160 304c0 34.3 12 65.8 32 90.5V416c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32v-26.8C26.2 371.2 0 332.7 0 288c0-61.9 50.1-112 112-112h32c24 0 46.2 7.5 64.4 20.3zM448 416v-21.5c20-24.7 32-56.2 32-90.5 0-42.8-18.7-81.3-48.4-107.7C449.8 183.5 472 176 496 176h32c61.9 0 112 50.1 112 112 0 44.7-26.2 83.2-64 101.2V416c0 17.7-14.3 32-32 32h-64c-17.7 0-32-14.3-32-32zm8-328a56 56 0 1 1 112 0 56 56 0 1 1-112 0zm120 157.7v84.7c10-11.3 16-26.1 16-42.3s-6-31.1-16-42.3zM320 32a64 64 0 1 1 0 128 64 64 0 1 1 0-128zm-80 272c0 16.2 6 31 16 42.3v-84.6c-10 11.3-16 26.1-16 42.3zm144-42.3v84.7c10-11.3 16-26.1 16-42.3s-6-31.1-16-42.3zm64 42.3c0 44.7-26.2 83.2-64 101.2V448c0 17.7-14.3 32-32 32h-64c-17.7 0-32-14.3-32-32v-42.8c-37.8-18-64-56.5-64-101.2 0-61.9 50.1-112 112-112h32c61.9 0 112 50.1 112 112z"/></svg>');--md-admonition-icon--solution:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M234.7 42.7 197 56.8c-3 1.1-5 4-5 7.2s2 6.1 5 7.2l37.7 14.1 14.1 37.7c1.1 3 4 5 7.2 5s6.1-2 7.2-5l14.1-37.7L315 71.2c3-1.1 5-4 5-7.2s-2-6.1-5-7.2l-37.7-14.1L263.2 5c-1.1-3-4-5-7.2-5s-6.1 2-7.2 5l-14.1 37.7zM46.1 395.4c-18.7 18.7-18.7 49.1 0 67.9l34.6 34.6c18.7 18.7 49.1 18.7 67.9 0l381.3-381.4c18.7-18.7 18.7-49.1 0-67.9l-34.6-34.5c-18.7-18.7-49.1-18.7-67.9 0L46.1 395.4zM484.6 82.6l-105 105-23.3-23.3 105-105 23.3 23.3zM7.5 117.2C3 118.9 0 123.2 0 128s3 9.1 7.5 10.8L64 160l21.2 56.5c1.7 4.5 6 7.5 10.8 7.5s9.1-3 10.8-7.5L128 160l56.5-21.2c4.5-1.7 7.5-6 7.5-10.8s-3-9.1-7.5-10.8L128 96l-21.2-56.5c-1.7-4.5-6-7.5-10.8-7.5s-9.1 3-10.8 7.5L64 96 7.5 117.2zm352 256c-4.5 1.7-7.5 6-7.5 10.8s3 9.1 7.5 10.8L416 416l21.2 56.5c1.7 4.5 6 7.5 10.8 7.5s9.1-3 10.8-7.5L480 416l56.5-21.2c4.5-1.7 7.5-6 7.5-10.8s-3-9.1-7.5-10.8L480 352l-21.2-56.5c-1.7-4.5-6-7.5-10.8-7.5s-9.1 3-10.8 7.5L416 352l-56.5 21.2z"/></svg>');--md-admonition-icon--technical:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M160 96a96 96 0 1 1 192 0 96 96 0 1 1-192 0zm80 152v264l-48.4-24.2c-20.9-10.4-43.5-17-66.8-19.3l-96-9.6C12.5 457.2 0 443.5 0 427V224c0-17.7 14.3-32 32-32h30.3c63.6 0 125.6 19.6 177.7 56zm32 264V248c52.1-36.4 114.1-56 177.7-56H480c17.7 0 32 14.3 32 32v203c0 16.4-12.5 30.2-28.8 31.8l-96 9.6c-23.2 2.3-45.9 8.9-66.8 19.3L272 512z"/></svg>');--md-admonition-icon--intermediate:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M320 32c-8.1 0-16.1 1.4-23.7 4.1L15.8 137.4C6.3 140.9 0 149.9 0 160s6.3 19.1 15.8 22.6l57.9 20.9C57.3 229.3 48 259.8 48 291.9V320c0 28.4-10.8 57.7-22.3 80.8-6.5 13-13.9 25.8-22.5 37.6-3.2 4.3-4.1 9.9-2.3 15s6 8.9 11.2 10.2l64 16c4.2 1.1 8.7.3 12.4-2s6.3-6.1 7.1-10.4c8.6-42.8 4.3-81.2-2.1-108.7-3.2-14.2-7.5-28.7-13.5-42v-24.6c0-30.2 10.2-58.7 27.9-81.5 12.9-15.5 29.6-28 49.2-35.7l157-61.7c8.2-3.2 17.5.8 20.7 9s-.8 17.5-9 20.7l-157 61.7c-12.4 4.9-23.3 12.4-32.2 21.6l159.6 57.6c7.6 2.7 15.6 4.1 23.7 4.1s16.1-1.4 23.7-4.1l280.6-101c9.5-3.4 15.8-12.5 15.8-22.6s-6.3-19.1-15.8-22.6L343.7 36.1c-7.6-2.7-15.6-4.1-23.7-4.1zM128 408c0 35.3 86 72 192 72s192-36.7 192-72l-15.3-145.4L354.5 314c-11.1 4-22.8 6-34.5 6s-23.5-2-34.5-6l-142.2-51.4L128 408z"/></svg>');--md-admonition-icon--advanced:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M219.3.5c3.1-.6 6.3-.6 9.4 0l200 40C439.9 42.7 448 52.6 448 64s-8.1 21.3-19.3 23.5L352 102.9V160c0 70.7-57.3 128-128 128S96 230.7 96 160v-57.1l-48-9.6v65.1l15.7 78.4c.9 4.7-.3 9.6-3.3 13.3S52.8 256 48 256H16c-4.8 0-9.3-2.1-12.4-5.9s-4.3-8.6-3.3-13.3L16 158.4V86.6C6.5 83.3 0 74.3 0 64c0-11.4 8.1-21.3 19.3-23.5l200-40zM111.9 327.7c10.5-3.4 21.8.4 29.4 8.5l71 75.5c6.3 6.7 17 6.7 23.3 0l71-75.5c7.6-8.1 18.9-11.9 29.4-8.5 65 20.9 112 81.7 112 153.6 0 17-13.8 30.7-30.7 30.7H30.7C13.8 512 0 498.2 0 481.3c0-71.9 47-132.7 111.9-153.6z"/></svg>');--md-admonition-icon--lumi-be:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M48 0C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h96v-80c0-26.5 21.5-48 48-48s48 21.5 48 48v80h96c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48H48zm16 240c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16v-32zm112-16h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16h-32c-8.8 0-16-7.2-16-16v-32c0-8.8 7.2-16 16-16zm80 16c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16h-32c-8.8 0-16-7.2-16-16v-32zM80 96h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16v-32c0-8.8 7.2-16 16-16zm80 16c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16h-32c-8.8 0-16-7.2-16-16v-32zm112-16h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16h-32c-8.8 0-16-7.2-16-16v-32c0-8.8 7.2-16 16-16zM448 0c-17.7 0-32 14.3-32 32v480h64V192h144c8.8 0 16-7.2 16-16V48c0-8.8-7.2-16-16-16H480c0-17.7-14.3-32-32-32z"/></svg>');--md-admonition-icon--nice-to-know:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M297.2 248.9c14.4-20.6 22.8-45.7 22.8-72.9 0-70.7-57.3-128-128-128S64 105.3 64 176c0 27.2 8.4 52.3 22.8 72.9 3.7 5.3 8.1 11.3 12.8 17.7 12.9 17.7 28.3 38.9 39.8 59.8 10.4 19 15.7 38.8 18.3 57.5H109c-2.2-12-5.9-23.7-11.8-34.5-9.9-18-22.2-34.9-34.5-51.8-5.2-7.1-10.4-14.2-15.4-21.4C27.6 247.9 16 213.3 16 176 16 78.8 94.8 0 192 0s176 78.8 176 176c0 37.3-11.6 71.9-31.4 100.3-5 7.2-10.2 14.3-15.4 21.4-12.3 16.8-24.6 33.7-34.5 51.8-5.9 10.8-9.6 22.5-11.8 34.5h-48.5c2.6-18.7 7.9-38.6 18.3-57.5 11.5-20.9 26.9-42.1 39.8-59.8 4.7-6.4 9-12.4 12.7-17.7zM192 128c-26.5 0-48 21.5-48 48 0 8.8-7.2 16-16 16s-16-7.2-16-16c0-44.2 35.8-80 80-80 8.8 0 16 7.2 16 16s-7.2 16-16 16zm0 384c-44.2 0-80-35.8-80-80v-16h160v16c0 44.2-35.8 80-80 80z"/></svg>');}</style>



    
    
      
    
    
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="lumi-be" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#exercises-4-running-jobs-with-slurm" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="LUMI-BE training materials" class="md-header__button md-logo" aria-label="LUMI-BE training materials" data-md-component="logo">
      
  
  <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- Created with Inkscape (http://www.inkscape.org/) -->

<svg
   width="800"
   height="220"
   viewBox="0 0 211.66666 58.208333"
   version="1.1"
   id="svg1706"
   inkscape:version="1.2.2 (b0a84865, 2022-12-01)"
   sodipodi:docname="logo.svg"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <sodipodi:namedview
     id="namedview1708"
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1.0"
     inkscape:showpageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     inkscape:document-units="mm"
     showgrid="false"
     inkscape:zoom="0.914906"
     inkscape:cx="372.16938"
     inkscape:cy="24.046186"
     inkscape:window-width="2400"
     inkscape:window-height="988"
     inkscape:window-x="767"
     inkscape:window-y="174"
     inkscape:window-maximized="0"
     inkscape:current-layer="layer1" />
  <defs
     id="defs1703" />
  <g
     inkscape:label="Laag 1"
     inkscape:groupmode="layer"
     id="layer1">
    <g
       aria-label="LUMI-BE"
       id="text4785"
       style="font-size:50.8px;line-height:1.25;-inkscape-font-specification:'sans-serif, Normal';fill:#f2f2f2;stroke-width:0.264583">
      <path
         d="M 23.366015,48.011253 H -7.4505806e-8 V 11.077074 H 4.911328 v 32.568554 h 18.454687 z"
         id="path6569" />
      <path
         d="m 56.083398,33.17805 q 0,4.01836 -0.892969,7.019727 -0.868164,2.976562 -2.877343,4.960937 -1.909961,1.885157 -4.464844,2.753321 -2.554883,0.868164 -5.953125,0.868164 -3.472656,0 -6.052344,-0.917774 -2.579687,-0.917773 -4.34082,-2.703711 -2.00918,-2.033984 -2.902148,-4.911328 -0.868164,-2.877343 -0.868164,-7.069336 V 11.077074 h 4.911328 v 22.349023 q 0,3.001367 0.396875,4.737696 0.421679,1.736328 1.389062,3.150195 1.091406,1.612304 2.951758,2.430859 1.885156,0.818555 4.514453,0.818555 2.654101,0 4.514453,-0.79375 1.860352,-0.818555 2.976562,-2.455664 0.967383,-1.413867 1.364258,-3.224609 0.42168,-1.835547 0.42168,-4.539258 V 11.077074 h 4.911328 z"
         id="path6571" />
      <path
         d="M 98.350579,48.011253 H 93.439251 V 16.18684 L 83.170111,37.841332 H 80.243158 L 70.048431,16.18684 V 48.011253 H 65.459564 V 11.077074 h 6.697266 l 9.84746,20.563086 9.525,-20.563086 h 6.821289 z"
         id="path6573" />
      <path
         d="m 121.29492,48.011253 h -14.58515 v -3.770312 h 4.83691 V 14.847387 h -4.83691 v -3.770313 h 14.58515 v 3.770313 h -4.83691 v 29.393554 h 4.83691 z"
         id="path6575" />
      <path
         d="m 143.22226,34.095824 h -15.47812 v -4.489648 h 15.47812 z"
         id="path6577" />
      <path
         d="m 179.83398,36.650707 q 0,2.75332 -1.0418,4.861718 -1.04179,2.108399 -2.80293,3.472657 -2.08359,1.637109 -4.58886,2.33164 -2.48047,0.694531 -6.3252,0.694531 H 151.97832 V 11.077074 h 10.93886 q 4.04317,0 6.05235,0.297656 2.00918,0.297657 3.84472,1.240235 2.03399,1.066601 2.95176,2.75332 0.91778,1.661914 0.91778,3.993555 0,2.629297 -1.33946,4.489648 -1.33945,1.835547 -3.57187,2.951758 v 0.198437 q 3.74551,0.768946 5.90351,3.299024 2.15801,2.505273 2.15801,6.35 z m -8.25996,-16.643945 q 0,-1.339454 -0.44648,-2.257227 -0.44649,-0.917773 -1.43868,-1.488281 -1.16582,-0.669727 -2.82773,-0.818555 -1.66191,-0.173633 -4.11758,-0.173633 h -5.8539 v 10.666016 h 6.35 q 2.30683,0 3.67109,-0.223242 1.36426,-0.248047 2.53008,-0.992188 1.16582,-0.74414 1.63711,-1.909961 0.49609,-1.190625 0.49609,-2.802929 z m 3.1502,16.842382 q 0,-2.232422 -0.66973,-3.54707 -0.66973,-1.314649 -2.43086,-2.232422 -1.19063,-0.620117 -2.90215,-0.79375 -1.68672,-0.198437 -4.11758,-0.198437 h -7.71425 v 13.741796 h 6.49882 q 3.22461,0 5.2834,-0.322461 2.05879,-0.347265 3.37344,-1.240234 1.38906,-0.967383 2.03398,-2.207617 0.64493,-1.240235 0.64493,-3.199805 z"
         id="path6579" />
      <path
         d="m 211.13749,48.011253 h -24.3334 V 11.077074 h 24.3334 v 4.365625 h -19.42207 v 10.120313 h 19.42207 v 4.365624 h -19.42207 v 13.716992 h 19.42207 z"
         id="path6581" />
    </g>
    <rect
       style="fill:#f2f2f2;stroke:none;stroke-width:0.988271;fill-opacity:1"
       id="rect4936"
       width="211.66667"
       height="3.175"
       x="0"
       y="0" />
    <rect
       style="fill:#f2f2f2;stroke:none;stroke-width:0.988271;fill-opacity:1"
       id="rect4936-7"
       width="211.66667"
       height="3.175"
       x="-8.3049135e-06"
       y="55.033333" />
  </g>
</svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LUMI-BE training materials
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Exercises 4
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="LUMI-BE training materials" class="md-nav__button md-logo" aria-label="LUMI-BE training materials" data-md-component="logo">
      
  
  <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- Created with Inkscape (http://www.inkscape.org/) -->

<svg
   width="800"
   height="220"
   viewBox="0 0 211.66666 58.208333"
   version="1.1"
   id="svg1706"
   inkscape:version="1.2.2 (b0a84865, 2022-12-01)"
   sodipodi:docname="logo.svg"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <sodipodi:namedview
     id="namedview1708"
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1.0"
     inkscape:showpageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     inkscape:document-units="mm"
     showgrid="false"
     inkscape:zoom="0.914906"
     inkscape:cx="372.16938"
     inkscape:cy="24.046186"
     inkscape:window-width="2400"
     inkscape:window-height="988"
     inkscape:window-x="767"
     inkscape:window-y="174"
     inkscape:window-maximized="0"
     inkscape:current-layer="layer1" />
  <defs
     id="defs1703" />
  <g
     inkscape:label="Laag 1"
     inkscape:groupmode="layer"
     id="layer1">
    <g
       aria-label="LUMI-BE"
       id="text4785"
       style="font-size:50.8px;line-height:1.25;-inkscape-font-specification:'sans-serif, Normal';fill:#f2f2f2;stroke-width:0.264583">
      <path
         d="M 23.366015,48.011253 H -7.4505806e-8 V 11.077074 H 4.911328 v 32.568554 h 18.454687 z"
         id="path6569" />
      <path
         d="m 56.083398,33.17805 q 0,4.01836 -0.892969,7.019727 -0.868164,2.976562 -2.877343,4.960937 -1.909961,1.885157 -4.464844,2.753321 -2.554883,0.868164 -5.953125,0.868164 -3.472656,0 -6.052344,-0.917774 -2.579687,-0.917773 -4.34082,-2.703711 -2.00918,-2.033984 -2.902148,-4.911328 -0.868164,-2.877343 -0.868164,-7.069336 V 11.077074 h 4.911328 v 22.349023 q 0,3.001367 0.396875,4.737696 0.421679,1.736328 1.389062,3.150195 1.091406,1.612304 2.951758,2.430859 1.885156,0.818555 4.514453,0.818555 2.654101,0 4.514453,-0.79375 1.860352,-0.818555 2.976562,-2.455664 0.967383,-1.413867 1.364258,-3.224609 0.42168,-1.835547 0.42168,-4.539258 V 11.077074 h 4.911328 z"
         id="path6571" />
      <path
         d="M 98.350579,48.011253 H 93.439251 V 16.18684 L 83.170111,37.841332 H 80.243158 L 70.048431,16.18684 V 48.011253 H 65.459564 V 11.077074 h 6.697266 l 9.84746,20.563086 9.525,-20.563086 h 6.821289 z"
         id="path6573" />
      <path
         d="m 121.29492,48.011253 h -14.58515 v -3.770312 h 4.83691 V 14.847387 h -4.83691 v -3.770313 h 14.58515 v 3.770313 h -4.83691 v 29.393554 h 4.83691 z"
         id="path6575" />
      <path
         d="m 143.22226,34.095824 h -15.47812 v -4.489648 h 15.47812 z"
         id="path6577" />
      <path
         d="m 179.83398,36.650707 q 0,2.75332 -1.0418,4.861718 -1.04179,2.108399 -2.80293,3.472657 -2.08359,1.637109 -4.58886,2.33164 -2.48047,0.694531 -6.3252,0.694531 H 151.97832 V 11.077074 h 10.93886 q 4.04317,0 6.05235,0.297656 2.00918,0.297657 3.84472,1.240235 2.03399,1.066601 2.95176,2.75332 0.91778,1.661914 0.91778,3.993555 0,2.629297 -1.33946,4.489648 -1.33945,1.835547 -3.57187,2.951758 v 0.198437 q 3.74551,0.768946 5.90351,3.299024 2.15801,2.505273 2.15801,6.35 z m -8.25996,-16.643945 q 0,-1.339454 -0.44648,-2.257227 -0.44649,-0.917773 -1.43868,-1.488281 -1.16582,-0.669727 -2.82773,-0.818555 -1.66191,-0.173633 -4.11758,-0.173633 h -5.8539 v 10.666016 h 6.35 q 2.30683,0 3.67109,-0.223242 1.36426,-0.248047 2.53008,-0.992188 1.16582,-0.74414 1.63711,-1.909961 0.49609,-1.190625 0.49609,-2.802929 z m 3.1502,16.842382 q 0,-2.232422 -0.66973,-3.54707 -0.66973,-1.314649 -2.43086,-2.232422 -1.19063,-0.620117 -2.90215,-0.79375 -1.68672,-0.198437 -4.11758,-0.198437 h -7.71425 v 13.741796 h 6.49882 q 3.22461,0 5.2834,-0.322461 2.05879,-0.347265 3.37344,-1.240234 1.38906,-0.967383 2.03398,-2.207617 0.64493,-1.240235 0.64493,-3.199805 z"
         id="path6579" />
      <path
         d="m 211.13749,48.011253 h -24.3334 V 11.077074 h 24.3334 v 4.365625 h -19.42207 v 10.120313 h 19.42207 v 4.365624 h -19.42207 v 13.716992 h 19.42207 z"
         id="path6581" />
    </g>
    <rect
       style="fill:#f2f2f2;stroke:none;stroke-width:0.988271;fill-opacity:1"
       id="rect4936"
       width="211.66667"
       height="3.175"
       x="0"
       y="0" />
    <rect
       style="fill:#f2f2f2;stroke:none;stroke-width:0.988271;fill-opacity:1"
       id="rect4936-7"
       width="211.66667"
       height="3.175"
       x="-8.3049135e-06"
       y="55.033333" />
  </g>
</svg>

    </a>
    LUMI-BE training materials
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    LUMI Intro (evolving)
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            LUMI Intro (evolving)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../00_Introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intro to the notes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_Architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02_CPE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Programming Environment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03_LUMI_access/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting access
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../E03_Exercises_1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exercises 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04_Modules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modules
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../E04_Exercises_2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exercises 2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05_Software_stacks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Software stacks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../E05_Exercises_3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exercises 3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06_Slurm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Slurm on LUMI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07_Binding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Exercises 4
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Exercises 4
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#exercises-on-the-slurm-allocation-modes" class="md-nav__link">
    <span class="md-ellipsis">
      Exercises on the Slurm allocation modes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#slurm-custom-binding-on-gpu-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Slurm custom binding on GPU nodes
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../08_Lustre/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lustre
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../09_Containers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Containers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Demo1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Container demo 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Demo2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Container demo 2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10_Support/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Support
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../A01_Slurm_issues/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A1 Slurm issues
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../A02_Documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A2 Documentation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#exercises-on-the-slurm-allocation-modes" class="md-nav__link">
    <span class="md-ellipsis">
      Exercises on the Slurm allocation modes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#slurm-custom-binding-on-gpu-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Slurm custom binding on GPU nodes
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="exercises-4-running-jobs-with-slurm">Exercises 4: Running jobs with Slurm<a class="headerlink" href="#exercises-4-running-jobs-with-slurm" title="Permanent link">&para;</a></h1>
<h2 id="exercises-on-the-slurm-allocation-modes">Exercises on the Slurm allocation modes<a class="headerlink" href="#exercises-on-the-slurm-allocation-modes" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>In this exercise we check how cores would be assigned to a shared memory program. 
    Run a single task on the CPU partition with <code>srun</code> using 16 cpu cores. 
    Inspect the default task allocation with the <code>taskset</code> command 
    (<code>taskset -cp $$</code> will show you the cpu numbers allocated to the current process). </p>
<details class="solution">
<summary>Click to see the solution.</summary>
<div class="highlight"><pre><span></span><code>srun --partition=small --nodes=1 --tasks=1 --cpus-per-task=16 --time=5 --account=&lt;project_id&gt; bash -c &#39;taskset -cp $$&#39; 
</code></pre></div>
<p>Note that you need to replace <code>&lt;project_id&gt;</code> with the actual project account ID of the 
form  <code>project_</code> plus a 9 digits number.</p>
<p>The command runs a single process (<code>bash</code> shell with the native Linux <code>taskset</code> tool showing 
process's CPU affinity) on a compute node. 
You can use the <code>man taskset</code> command to see how the tool works.</p>
</details>
</li>
<li>
<p>Next we'll try a hybrid MPI/OpenMP program.
    For this we will use the <code>hybrid_check</code> tool from the <code>lumi-CPEtools</code> module of the LUMI Software Stack. 
    This module is preinstalled on the system and has versions for all versions of the <code>LUMI</code> software stack
    and all toolchains and partitions in those stacks.</p>
<p>Use the simple job script below to run a parallel program with multiple tasks (MPI ranks) and threads (OpenMP). 
Submit with <code>sbatch</code> on the CPU partition and check task and thread affinity.</p>
<div class="highlight"><pre><span></span><code>#!/bin/bash -l
#SBATCH --partition=small           # Partition (queue) name
#SBATCH --nodes=1                   # Total number of nodes
#SBATCH --ntasks-per-node=8         # 8 MPI ranks per node
#SBATCH --cpus-per-task=16          # 16 threads per task
#SBATCH --time=5                    # Run time (minutes)
#SBATCH --account=&lt;project_id&gt;      # Project for billing

module load LUMI/23.09
module load lumi-CPEtools/1.1-cpeGNU-23.09

srun --cpus-per-task=$SLURM_CPS_PER_TASK hybrid_check -n -r
</code></pre></div>
<p>Be careful with copy/paste of the script body as copy problems with special characters or a double dash may 
occur, depending on the editor you use.</p>
<details class="solution">
<summary>Click to see the solution.</summary>
<p>Save the script contents into the file  <code>job.sh</code> (you can use the <code>nano</code> console text editor for instance). 
Remember to use valid project account name.</p>
<p>Submit the job script using the <code>sbatch</code> command:</p>
<div class="highlight"><pre><span></span><code>sbatch job.sh
</code></pre></div>
<p>The job output is saved in the <code>slurm-&lt;job_id&gt;.out</code> file. 
You can view its content with either the <code>less</code> or <code>more</code> shell commands.</p>
<p>The actual task/threads affinity may depend on the specific OpenMP runtime 
(if you literally use this job script it will be the GNU OpenMP runtime).</p>
</details>
</li>
<li>
<p>Improve the thread affinity with OpenMP runtime variables. 
   Alter the script from the previous exercise and ensure that each thread is bound to
   a specific core. </p>
<details class="solution">
<summary>Click to see the solution.</summary>
<p>Add the following OpenMP environment variables definition to your script:</p>
<div class="highlight"><pre><span></span><code>export OMP_NUM_THREADS=${SLURM_CPUS_PER_TASK}
export OMP_PROC_BIND=close
export OMP_PLACES=cores
</code></pre></div>
<p>You can also use an MPI runtime variable to have MPI itself report a cpu mask summary for each MPI rank:</p>
<div class="highlight"><pre><span></span><code>export MPICH_CPUMASK_DISPLAY=1
</code></pre></div>
<p>Note <code>hybrid_check</code> and MPICH cpu mask may not be consistent. It is found to be confusing.</p>
<p>To avoid having to use the <code>--cpus-per-task</code> flag, you can also set the environment variable <code>SRUN_CPUS_PER_TASK</code>
instead: </p>
<div class="highlight"><pre><span></span><code>export SRUN_CPUS_PER_TASK=16 
</code></pre></div>
<p>On LUMI this is not strictly necessary as the Slurm SBATCH processing has been modified to set
this environment variable, but that was a clunky patch to reconstruct some old behaviour of Slurm
and we have already seen cases where the patch did not work (but that were more complex cases that
required different environment variables for a similar function).</p>
<p>The list of environment variables that the <code>srun</code> command can use as input, is actually confusing, as
some start with <code>SLURM_</code> but a few start with <code>SRUN_</code> while the <code>SLURM_</code> equivalent is ignored.</p>
<p>So we end up with the following script:</p>
<div class="highlight"><pre><span></span><code>#!/bin/bash -l
#SBATCH --partition=small           # Partition (queue) name
#SBATCH --nodes=1                   # Total number of nodes
#SBATCH --ntasks-per-node=8         # 8 MPI ranks per node
#SBATCH --cpus-per-task=16          # 16 threads per task
#SBATCH --time=5                    # Run time (minutes)
#SBATCH --account=&lt;project_id&gt;      # Project for billing

module load LUMI/23.09
module load lumi-CPEtools/1.1-cpeGNU-23.09

export SRUN_CPUS_PER_TASK=$SLURM_CPUS_PER_TASK

export OMP_NUM_THREADS=${SLURM_CPUS_PER_TASK}
export OMP_PROC_BIND=close
export OMP_PLACES=cores

export MPICH_CPUMASK_DISPLAY=1

srun hybrid_check -n -r
</code></pre></div>
<p>Note that MPI returns the CPU mask per process in binary form (a long string of zeros and ones)
where the last number is for core 0. Also, you'll see that with the OpenMP environment variables
set, it will look like only one core can be used by each MPI task, but that is because it only
shows the mask for the main process which becomes OpenMP thread 0. Remove the OpenMP environment
variables and you'll see that each task now gets 16 possible cores to run on, and the same is true
for each OpenMP thread (at least when using the GNU compilers, the Cray compilers have different
default behaviour for OpenMP which actually makes more sense for most scientific computing codes).</p>
</details>
</li>
<li>
<p>Build the <code>hello_jobstep</code> program tool using interactive shell on a GPU node. 
    You can pull the source code for the program from git repository 
    <a href="https://code.ornl.gov/olcf/hello_jobstep"><code>https://code.ornl.gov/olcf/hello_jobstep.git</code></a>. 
    It uses a <code>Makefile</code> for building and requires Clang and HIP. 
    The <code>hello_jobstep</code> program is actually the main source of inspiration for the 
    <code>gpu_check</code> program in the <code>lumi-CPEtools</code> modules for <code>partition/G</code>.
    Try to run the program interactively. </p>
<details class="solution">
<summary>Click to see the solution.</summary>
<p>Clone the code using <code>git</code> command:</p>
<div class="highlight"><pre><span></span><code>git clone https://code.ornl.gov/olcf/hello_jobstep.git
</code></pre></div>
<p>It will create <code>hello_jobstep</code> directory consisting source code and <code>Makefile</code>.</p>
<p>Allocate resources for a single task with a single GPU with <code>salloc</code>:</p>
<div class="highlight"><pre><span></span><code>salloc --partition=small-g --nodes=1 --tasks=1 --cpus-per-task=1 --gpus-per-node=1 --time=10 --account=&lt;project_id&gt;
</code></pre></div>
<p>Note that, after allocation is granted, you receive new shell but are still on the compute node. 
You need to use the <code>srun</code> command to run on the allocated node. </p>
<p>Start interactive session on a GPU node:</p>
<div class="highlight"><pre><span></span><code>srun --pty bash -i
</code></pre></div>
<p>Note now you are on the compute node. <code>--pty</code> option for <code>srun</code> is required to interact with the remote shell.</p>
<p>Enter the <code>hello_jobstep</code> directory and issue <code>make</code> command. </p>
<p>As an example we will built with the system default programming environment, <code>PrgEnv-cray</code> in <code>CrayEnv</code>. 
Just to be sure we'll load even the programming environment module explicitly.</p>
<p>The build will fail if the <code>rocm</code> module is not loaded when using <code>PrgEnv-cray</code>.</p>
<div class="highlight"><pre><span></span><code>module load CrayEnv
module load PrgEnv-cray
module load rocm
</code></pre></div>
<p>To build the code, use</p>
<div class="highlight"><pre><span></span><code>make LMOD_SYSTEM_NAME=&quot;frontier&quot;
</code></pre></div>
<p>You need to add <code>LMOD_SYSTEM_NAME="frontier"</code> variable for make as the code originates from the Frontier system
and doesn't know LUMI.</p>
<p>(As an exercise you can try to fix the <code>Makefile</code> and enable it for LUMI :))</p>
<p>Finally you can just execute <code>./hello_jobstep</code> binary program to see how it behaves:</p>
<div class="highlight"><pre><span></span><code>./hello_jobstep
</code></pre></div>
<p>Note that executing the program with <code>srun</code> in the srun interactive session will result in a hang.
You need to work with <code>--overlap</code> option for srun to mitigate this.</p>
<p>Remember to terminate your interactive session with <code>exit</code> command.</p>
<p><div class="highlight"><pre><span></span><code>exit
</code></pre></div>
and then do the same for the shell created by <code>salloc</code> also.</p>
</details>
</li>
</ol>
<h2 id="slurm-custom-binding-on-gpu-nodes">Slurm custom binding on GPU nodes<a class="headerlink" href="#slurm-custom-binding-on-gpu-nodes" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Allocate one GPU node with one task per GPU and bind tasks to each CCD (8-core group sharing L3 cache) 
    leaving the first (#0) and last (#7) cores unused. 
    Run a program with 6 threads per task and inspect the actual task/threads affinity
    using either the <code>hello_jobstep</code> executable generated in the previous exercise, or the
    <code>gpu_check</code> command from tne <code>lumi-CPEtools</code> module.</p>
<details class="solution">
<summary>Click to see the solution.</summary>
<p>We can chose between different approaches. In the example below,
we follow the 
<a href="../07_Binding/#linear-assignment-of-gcd-then-match-the-cores">"GPU binding: Linear GCD, match cores"</a> 
slides and we only need to adapt the CPU mask:</p>
<div class="highlight"><pre><span></span><code>#!/bin/bash -l
#SBATCH --partition=standard-g  # Partition (queue) name
#SBATCH --nodes=1               # Total number of nodes
#SBATCH --ntasks-per-node=8     # 8 MPI ranks per node
#SBATCH --gpus-per-node=8       # Allocate one gpu per MPI rank
#SBATCH --time=5                # Run time (minutes)
#SBATCH --account=&lt;project_id&gt;  # Project for billing
#SBATCH --hint=nomultithread

cat &lt;&lt; EOF &gt; select_gpu_$SLURM_JOB_ID
#!/bin/bash
export ROCR_VISIBLE_DEVICES=\$SLURM_LOCALID
exec \$*
EOF
chmod +x ./select_gpu_$SLURM_JOB_ID

CPU_BIND=&quot;mask_cpu:0xfe000000000000,0xfe00000000000000,&quot;
CPU_BIND=&quot;${CPU_BIND}0xfe0000,0xfe000000,&quot;
CPU_BIND=&quot;${CPU_BIND}0xfe,0xfe00,&quot;
CPU_BIND=&quot;${CPU_BIND}0xfe00000000,0xfe0000000000&quot;

export OMP_NUM_THREADS=6
export OMP_PROC_BIND=close
export OMP_PLACES=cores

srun --cpu-bind=${CPU_BIND} ./select_gpu_$SLURM_JOB_ID ./hello_jobstep
</code></pre></div>
<p>The base mask we need for this exercise, with each first and last core of a chiplet disabled,
is <code>01111110</code> which is <code>0x7e</code> in hexadecimal notation.</p>
<p>Save the job script as <code>job_step.sh</code> then simply submit it with sbatch from the directory
that contains the <code>hello_jobstep</code> executable. Inspect the job output.</p>
<p>Note that in fact as this program was compiled with the Cray compiler in the previous exercise,
you don't even need to use the <code>OMP_*</code> environment variables above as the threads are 
automatically pinned to a single core and as the correct number of threads is derived from
the affinity mask for each task.</p>
<p>Or using <code>gpu_check</code> instead (and we'll use the <code>cpeGNU</code> version again):</p>
<div class="highlight"><pre><span></span><code>#!/bin/bash -l
#SBATCH --partition=standard-g  # Partition (queue) name
#SBATCH --nodes=1               # Total number of nodes
#SBATCH --ntasks-per-node=8     # 8 MPI ranks per node
#SBATCH --gpus-per-node=8       # Allocate one gpu per MPI rank
#SBATCH --time=5                # Run time (minutes)
#SBATCH --account=&lt;project_id&gt;  # Project for billing
#SBATCH --hint=nomultithread

module load LUMI/23.09
module load lumi-CPEtools/1.1-cpeGNU-23.09

cat &lt;&lt; EOF &gt; select_gpu_$SLURM_JOB_ID
#!/bin/bash
export ROCR_VISIBLE_DEVICES=\$SLURM_LOCALID
exec \$*
EOF
chmod +x ./select_gpu_$SLURM_JOB_ID

CPU_BIND=&quot;mask_cpu:0xfe000000000000,0xfe00000000000000,&quot;
CPU_BIND=&quot;${CPU_BIND}0xfe0000,0xfe000000,&quot;
CPU_BIND=&quot;${CPU_BIND}0xfe,0xfe00,&quot;
CPU_BIND=&quot;${CPU_BIND}0xfe00000000,0xfe0000000000&quot;

export OMP_NUM_THREADS=6
export OMP_PROC_BIND=close
export OMP_PLACES=cores

srun --cpu-bind=${CPU_BIND} ./select_gpu_$SLURM_JOB_ID gpu_check -l
</code></pre></div>
</details>
</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        

<footer class="md-footer">
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
          <img alt="Creative Commons License" 
              style="border-width:0" 
              src="https://i.creativecommons.org/l/by/4.0/80x15.png"
          />
        </a>
        This work is licensed under a&nbsp;
        <a rel="license" 
          href="http://creativecommons.org/licenses/by/4.0/"
        >
          Creative Commons Attribution 4.0 International License
        </a>
      </div>      
      <div class="md-social">
  
</div>
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.top", "navigation.indexes", "header.autohide", "toc.follow", "content.code.annotate", "content.code.copy"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
    
  </body>
</html>